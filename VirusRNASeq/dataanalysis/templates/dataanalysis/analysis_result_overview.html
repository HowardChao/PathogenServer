{% extends 'base_checkfile.html' %}

{% block extraheader %}
{% load staticfiles %}
{% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/dataanalysis_result_overview.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
{% endblock extraheader %}

{% block content %}
<div class="wrapper">
    <!-- Sidebar -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3>Samples</h3>
        </div>
        <ul class="list-unstyled components">
        {% for key, value in samples_list_key.items %}
            <li>
                <p style="font-size: 23px;"><b><i class="fas fa-object-group"></i> &nbsp {{ key }} </b></p>
            </li>
            {% for v in value %}
                <li>
                    <a href="#" onclick="loading(this.name)" name="quality_control_result" style="margin-left: 20px"><i class="fas fa-dot-circle"></i> &nbsp {{ v }}</a>
                </li>
            {% endfor %}
        {% endfor %}
        </ul>
    </nav>

    <nav id="sidebar">
        <div class="sidebar-header">
            <h3>Dashboard</h3>
        </div>
        <ul class="list-unstyled components">
            <li>
                <a href="#" onclick="loading(this.name)" name="overview_page_result"><i class="fas fa-file-contract"></i> &nbsp OverView</a>
            </li>
            <li>
                <a href="#" onclick="loading(this.name)" name="quality_control_result"><i class="fas fa-search"></i> &nbsp Quality Control</a>
            </li>
            <li>
                <a href="#" onclick="loading(this.name)" name="read_subtraction_result"><i class="fas fa-minus"></i>  &nbsp Read Subtraction</a>
            </li>
            <li>
                <a href="#" onclick="loading(this.name)" name="non-virus_removal_result"><i class="fas fa-search-minus"></i> &nbsp Non-virus Removal</a>
            </li>
            <li>
                <a href="#"><i class="fas fa-align-right"></i> &nbsp <i>de novo</i> Assembly</a>
            </li>
            <li>
                <a href="#"><i class="fas fa-reply"></i> &nbsp Reads Realignment</a>
            </li>
            <li>
                <a href="#"><i class="fas fa-database"></i> &nbsp Homology Search</a>
            </li>
            <li>
                <a href="#"><i class="fas fa-dna"></i> &nbsp Variant Calling</a>
            </li>
        </ul>
    </nav>
    <!-- Page Content -->
    <div id="right-content-overview" class="w-100">
        <div id="content" >
            <button type="button" id="sidebarCollapse" class="btn btn-info ">
                <i id="toggle_button" class="fas fa-angle-double-left"></i>
            </button>

        </div>
        <div class="pipeline_result" id="overview_page_result" >
            <div class="w3-main" style="margin-left:130px; margin-right:130px;">
                <header class="w3-container" style="padding-top:22px;">
                    <h1 class="content-title-group" style="margin-left:-40px;"><i class="fas fa-file-contract"></i> &nbsp<strong>Overview</strong></h1>
                </header>
                <div class="content-below-header-overview" >
                    <div class="w3-row-padding w3-margin-bottom" style="margin-top:50px;">
                        <div style="width:100%; outline: 5px solid #B07B41; outline-offset: 10px; outline-style: double;">
                        <p>Congradulations! Your job has been completed <strong style="font-size:20px; color: green;">successfully</strong>!</p>
                        <p>The followings are the project information of your analysis job. You can click the download link to install all the logs and results.</p>
                        <p>Click the buttons on the right navigation dashboard to show the results of each step.</p>
                        </div>
                    </div>
                    <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:70px;">
                        <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>Project Information</b></h4>
                        <table class="w3-table w3-striped w3-white" style="width:100%; margin-top:15px;">
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Project Name :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{project_name}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Email :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{email}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Analysis Code :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{analysis_code}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Submission Time :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{submission_time}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Start Time :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{start_time}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>End Time :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{end_time}}</td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Download Link :</b></td>
                                <td>
                                    <button style="font-family: Verdana, Geneva, sans-serif" type="button" class="btn btn-success"> Download <i class="fas fa-arrow-down"></i></button>

                                    {% comment %} <a class="w3-button w3-round-large w3-border w3-tiny" style="background-color:#d6efeb;font-size:16px" href="/static/0436de14-7762-11e8-b3cc-d89d67f39fa9/myjob.tar.gz" role="button">
                                    Download  <i class="fa fa-arrow-down"></i>
                                    </a> {% endcomment %}
                                </td>
                            </tr>
                        </table>
                        <div style="margin-bottom: 100px">
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="pipeline_result" id="quality_control_result"  style="display: none;">
            <div class="w3-main" style="margin-left:130px; margin-right:130px;">
                <header class="w3-container" style="padding-top:22px;">
                    <h1 class="content-title-group" style="margin-left:-40px;"><i class="fas fa-search"></i> &nbsp <strong>Quality Control</strong></h1>
                </header>

                <div class="content-below-header-overview" >
                    <div class="w3-row-padding w3-margin-bottom" style="margin-top:50px;">
                        <div style="width:100%; outline: 5px solid #B07B41; outline-offset: 10px; outline-style: double;">
                          <p>Congradulations! Your job has been completed <strong style="font-size:20px; color: green;">successfully</strong>!</p>
                        </div>
                    </div>
                    <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:70px;">
                        <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>Before Trimming Quality Assessment</b></h4>
                        <table class="w3-table w3-striped w3-white" style="width:100%; margin-top:15px;">
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> MultiQC Summary Report :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_pre_multiqc_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a></td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> FastQC R1 (forward) :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_pre_fastqc_r1_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a></td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> FastQC R2 (reverse) :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_pre_fastqc_r2_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a></td>
                            </tr>
                        </table>
                    </div>
                    <hr>
                    <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:40px;">
                        <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>After Trimming Quality Assessment</b></h4>
                        <table class="w3-table w3-striped w3-white" style="width:100%; margin-top:15px;">
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> MultiQC Summary Report :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_post_multiqc_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> FastQC R1 (forward) :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_post_fastqc_r1_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b> FastQC R2 (reverse) :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif"><a target="_blank" rel="noopener noreferrer" href={% url "dataanalysis_result_current_status_post_fastqc_r2_html" slug_project=url_parameter %} class="link_color"><u>Link</u></a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <hr>
                    <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:40px;">
                        <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>Trimmomatic Visualization Report</b></h4>
                        <div class="w-100" id="piechart_3d" style="height: 300px;">
                            <!--<img src="/w3images/region.jpg" style="width:100%" alt="Google Regional Map">-->
                        </div>
                    </div>
                    <div style="margin-bottom: 100px">
                    </div>
                </div>
            </div>

        </div>

        <div class="pipeline_result" id="read_subtraction_result" style="display: none;">
            <div class="w3-main" style="margin-left:130px; margin-right:130px;">
                <header class="w3-container" style="padding-top:22px;">
                    <h1 class="content-title-group" style="margin-left:-40px;"><i class="fas fa-minus"></i>  &nbsp<strong>Read Subtraction</strong></h1>
                </header>
                <div class="content-below-header-overview" >
                    <div class="w3-row-padding w3-margin-bottom" style="margin-top:50px;">
                        <div style="width:100%; outline: 5px solid #B07B41; outline-offset: 10px; outline-style: double;">
                          <p>Reads subtraction description here !</p>
                        </div>
                    </div>
                    <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:70px;">
                        <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>Title</b></h4>
                        <table class="w3-table w3-striped w3-white" style="width:100%; margin-top:15px;">
                            <tr>
                                <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Project Name :</b></td>
                                <td style="font-family: Verdana, Geneva, sans-serif">{{project_name}}</td>
                            </tr>
                        </table>
                        <div style="margin-bottom: 100px">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="pipeline_result" id="non-virus_removal_result" style="display: none;">
          <div class="w3-main" style="margin-left:130px; margin-right:130px;">
              <header class="w3-container" style="padding-top:22px;">
                  <h1 class="content-title-group" style="margin-left:-40px;"><i class="fas fa-search-minus"></i> &nbsp<strong>Non-Virus Reads Removal</strong></h1>
              </header>
              <div class="content-below-header-overview" >
                  <div class="w3-row-padding w3-margin-bottom" style="margin-top:50px;">
                      <div style="width:100%; outline: 5px solid #B07B41; outline-offset: 10px; outline-style: double;">
                        <p>Reads subtraction description here !</p>
                      </div>
                  </div>
                  <div class="w3-row-padding w3-margin-bottom" style="float:center; margin-top:70px;">
                      <h4 class="content-title-group"><i class="fas fa-dot-circle"></i>&nbsp&nbsp<b>Title</b></h4>
                      <table class="w3-table w3-striped w3-white" style="width:100%; margin-top:15px;">
                          <tr>
                              <td style="font-family: Verdana, Geneva, sans-serif" width="30%"><b>Project Name :</b></td>
                              <td style="font-family: Verdana, Geneva, sans-serif">{{project_name}}</td>
                          </tr>
                      </table>
                      <div style="margin-bottom: 100px">
                      </div>
                  </div>
              </div>
          </div>
        </div>
    </div>






    {% comment %}
    This is the place to reload the page base on the current status
    {% if check_first_qc_ans and check_trimming_qc_ans and check_second_qc_ans and check_read_subtraction_bwa_align_ans%}
    {% else %}
        <script>
        console.log("check_first_qc_ans", "{{check_first_qc_ans}}");
        console.log("check_trimming_qc_ans", "{{check_trimming_qc_ans}}");
        console.log("check_second_qc_ans", "{{check_second_qc_ans}}");
        console.log("check_read_subtraction_bwa_align_ans", "{{check_read_subtraction_bwa_align_ans}}")
        setTimeout(function(){
        window.location.reload(1);
        }, 8000);
        </script>
    {% endif %} {% endcomment %}


    {% comment %} <div id="content" class="w-100" >
        <main role="main" class="container">

            <div class="row">
                <div id="card_trimmomatic" class="card bg-light mt-5 mb-3 w-100 ">
                    <div class="card-header"><p class="h2"><i class="fas fa-cut"></i> &nbsp &nbsp OverView {{ variable.inside_or_outside }} </p></div>
                    <div class="card-body w-100">
                        <h5 class="card-title">Read with low quality would be deleted</h5>
                        <p class="card-text"></p>
                    </div>
                </div>


            </div>
        </main>
    </div> {% endcomment %}
</div>
<script type="text/javascript">
$(document).ready(function () {

    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');
        if ($(".active").hasClass("active")) {
            // do this
            console.log("hidden");
            document.getElementById("toggle_button").className = "fas fa-align-left";
        } else {
            // do that
            console.log("not hidden");
            document.getElementById("toggle_button").className = "fas fa-angle-double-left";
        }
    });

});

    // This script is to show different page
    function loading(clicked_name)
    {
        $(".pipeline_result").hide();
        $("#"+clicked_name).show();

    }

</script>

<script type="text/javascript">
 google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([["status", "reads number"], ["Both Surviving", {{trimmo_both_surviving}}], ["Forward Only Surviving", {{trimmo_forward_only_surviving}}], ["Reverse Only Surviving", {{trimmo_reverse_only_surviving}}], ["Dropped", {{trimmo_dropped}}]]);
        var options = {
          'title': 'Trimmomatic Report',
          is3D: true,
          chartArea:{width:'60%',height:'75%'},
          'width':700,
          'height':300,
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
        chart.draw(data, options);
      }
</script>


{% endblock content %}
